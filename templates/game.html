<!DOCTYPE html>
<html>
<head>
  <title>Tic Tac Toe</title>
  <style>
    .board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin-top: 20px; }
    .cell { width: 100px; height: 100px; font-size: 2em; text-align: center; }
  </style>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <h1>ðŸŽ® Tic Tac Toe</h1>
  <p id="status">Welcome!</p>

  <!-- Create game button -->
  <button onclick="createGame()">Create New Game</button>

  <!-- Join game form -->
  <form id="joinForm" onsubmit="joinGame(event)">
    <input id="joinCode" placeholder="Enter Game Code">
    <button type="submit">Join Game</button>
  </form>

  <!-- Game area -->
  <div id="gameArea" style="display:none;">
    <h3 id="gameCode"></h3>
    <p id="turn">Turn: </p>
    <div class="board" id="board"></div>
  </div>

  <script>
    const socket = io();
    let gameCode = null;

    function createGame() {
      socket.emit("create_game");
      document.getElementById("status").innerText = "Creating game...";
      document.getElementById("joinForm").style.display = "none";
    }

    function joinGame(e) {
      e.preventDefault();
      const code = document.getElementById("joinCode").value.trim();
      socket.emit("join_game", { code });
    }

    function renderBoard(board, turn) {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      board.forEach((cell, i) => {
        const btn = document.createElement("button");
        btn.classList.add("cell");
        btn.innerText = cell || "-";
        btn.disabled = cell !== "";
        btn.onclick = () => socket.emit("make_move", { code: gameCode, index: i });
        boardDiv.appendChild(btn);
      });
      document.getElementById("turn").innerText = "Turn: " + turn;
    }

    socket.on("game_created", data => { 
      gameCode = data.code; 
      document.getElementById("gameArea").style.display = "block";
      document.getElementById("gameCode").innerText = "Game Code: " + gameCode;
      renderBoard(data.board, data.turn);
    });

    socket.on("waiting", data => {
      document.getElementById("status").innerText = data.message;
    });

    socket.on("game_joined", data => {
      gameCode = data.code;
      document.getElementById("status").innerText = "Joined game " + data.code;
      document.getElementById("joinForm").style.display = "none";
      document.getElementById("gameArea").style.display = "block";
      document.getElementById("gameCode").innerText = "Game Code: " + data.code;
      renderBoard(data.board, data.turn);
    });

    socket.on("start_game", data => renderBoard(data.board, data.turn));
    socket.on("move_made", data => renderBoard(data.board, data.turn));
    socket.on("error", data => alert(data.message));
  </script>
</body>
</html>
